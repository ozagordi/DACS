dyn_vars <- dim(samsungData)[2]-2
suff <- paste0("-v", 1:dyn_vars)
names(samsungData)[1:dyn_vars] <- paste0(names(samsungData)[1:dyn_vars], suff)
names(samsungData)
library(randomForest)
library(ggplot2)
load('samsungData.rda')
# reformat names and cure duplicates, activity as factor
names(samsungData) <- gsub('[[:punct:]]', "_", names(samsungData))
dyn_vars <- dim(samsungData)[2]-2
suff <- paste0("-v", 1:dyn_vars)
names(samsungData)[1:dyn_vars] <- paste0(names(samsungData)[1:dyn_vars], suff)
samsungData$activity <- as.factor(samsungData$activity)
# train, test and validate
tree1 <- tree(as.factor(activity) ~ fBodyAcc_mean___X + fBodyAcc_mean___Y + fBodyAcc_mean___Z +
fBodyAcc_meanFreq___X + fBodyAcc_meanFreq___Y +
fBodyAcc_meanFreq___Z, data=samsungData)#, subset=subject==6)
plot(tree1)
text(tree1)
install.packages("randomForest")
?randomForest
library(randomForest)
?randomForest
testData <- subset(samsungData, subject==27)
table(testData$subject)
testData <- subset(samsungData, subject==27 | subject==28)
table(testData$subject)
testData <- subset(samsungData, subject==27 | subject==28 | subject==29 | subject==30)
table(testData$subject)
library(randomForest)
load('samsungData.rda')
# reformat names and cure duplicates, activity as factor
names(samsungData) <- gsub('[[:punct:]]', "_", names(samsungData))
dyn_vars <- dim(samsungData)[2]-2
suff <- paste0("-v", 1:dyn_vars)
names(samsungData)[1:dyn_vars] <- paste0(names(samsungData)[1:dyn_vars], suff)
samsungData$activity <- as.factor(samsungData$activity)
# split data in train, test and validate sets
trainData <- subset(samsungData, subject==1 | subject==3 | subject==5 | subject==6)
testData <- subset(samsungData, subject==27 | subject==28 | subject==29 | subject==30)
rf <- randomForest(activity ~ ., data=trainData)
names(samsungData)[1:10]
names(trainData)[1:10]
head(trainData)
head(trainData[,1:10])
rf <- randomForest(activity ~ ., data=trainData)
rf <- randomForest(activity ~ ., data=trainData, importance=TRUE, proximity=TRUE)
library(randomForest)
#library(ggplot2)
load('samsungData.rda')
# reformat names and cure duplicates, activity as factor
names(samsungData) <- gsub('[[:punct:]]', "_", names(samsungData))
dyn_vars <- dim(samsungData)[2]-2
suff <- paste0("-v", 1:dyn_vars)
names(samsungData)[1:dyn_vars] <- paste0(names(samsungData)[1:dyn_vars], suff)
samsungData$activity <- as.factor(samsungData$activity)
# split data in train, test and validate sets
trainData <- subset(samsungData, subject==1 | subject==3 | subject==5 | subject==6)
testData <- subset(samsungData, subject==27 | subject==28 | subject==29 | subject==30)
rf <- randomForest(activity ~ ., data=trainData, importance=TRUE, proximity=TRUE)
ls()
rm(ls())
library(randomForest)
#library(ggplot2)
load('samsungData.rda')
# reformat names and cure duplicates, activity as factor
names(samsungData) <- gsub('[[:punct:]]', "_", names(samsungData))
dyn_vars <- dim(samsungData)[2]-2
suff <- paste0("-v", 1:dyn_vars)
names(samsungData)[1:dyn_vars] <- paste0(names(samsungData)[1:dyn_vars], suff)
samsungData$activity <- as.factor(samsungData$activity)
# split data in train, test and validate sets
trainData <- subset(samsungData, subject==1 | subject==3 | subject==5 | subject==6)
testData <- subset(samsungData, subject==27 | subject==28 | subject==29 | subject==30)
rf <- randomForest(activity ~ ., data=trainData, importance=TRUE, proximity=TRUE)
plot(tree1)
rf <- randomForest(activity ~ ., data=samsungData, importance=TRUE, proximity=TRUE)
library(randomForest)
#library(ggplot2)
load('samsungData.rda')
# reformat names and cure duplicates, activity as factor
names(samsungData) <- gsub('[[:punct:]]', "_", names(samsungData))
dyn_vars <- dim(samsungData)[2]-2
suff <- paste0("_v", 1:dyn_vars)
names(samsungData)[1:dyn_vars] <- paste0(names(samsungData)[1:dyn_vars], suff)
samsungData$activity <- as.factor(samsungData$activity)
# split data in train, test and validate sets
trainData <- subset(samsungData, subject==1 | subject==3 | subject==5 | subject==6)
testData <- subset(samsungData, subject==27 | subject==28 | subject==29 | subject==30)
rf <- randomForest(activity ~ ., data=samsungData, importance=TRUE, proximity=TRUE)
rf <- randomForest(activity ~ ., data=trainData, importance=TRUE, proximity=TRUE)
summary(rf)
print(rf)
round(importance(iris.rf), 2)
round(importance(rf), 2)
plot(rf, log="y")
varImpPlot(rf)
MDSplot(rf, trainData$activity)
predict(rf)
predict(rf, testData)
dim(testData)
xyz<-predict(rf, testData)
dim(xyz)
str(xyz)
preds <- predict(rf, testData) == testData$activity
preds
table(preds)
1377 / (1377+108)
?rfcv
result <- rfcv(trainData, trainData$activity)
result <- rfcv(trainData, trainData$activity, do.trace=TRUE)
with(result, plot(n.var, error.cv, log="x", type="o", lwd=2))
result$error.cv
result$n.var
missClass = function(values, prediction){
sum((prediction != values) * 1 / length(values))
}
missClass(c("x", "y", "x"), c("x", "y", "z"))
missClass(c("x", "y", "x"), c("x", "y", "x"))
missClass(c("x", "y", "x"), c("x", "y", "z"))
preds <- predict(rf, testData)
missClass(preds, testData$activity)
load('samsungData.rda')
dim(samsungData)
max(samsungData)
load('samsungData.rda')
max(samsungData[,-c(562,563)])
min(samsungData[,-c(562,563)])
table(samsungData$subject)
unique(samsungData$subject)
length(unique(samsungData$subject))
names(samsungData)
length(unique(names(samsungData)))
Project 2: analysis of Samsung S II motion data
========================================================
## Introduction
Smartphones are undoubtedly one of the most successful technologies of the last
few years, with hundreds of millions of units sold per year [1][]. Among many
other different characteristics, several models feature on-board accelerometer
and gyroscope. Generally speaking, these devices measure changes in the position
and the orientation of the phone, respectively. Their simplest application is
the adaptation of the screen orientation when the phone is rotated.
These accessories can also transform mobile phones into, for example,
compasses and levels, and more in general they allow the development of
movement-aware software.
In this analysis, we study whether it is possible to accurately predict the
activity performed by a user from the acceleration and orientation of their
smartphone. To this end we analyzed the measures from the accelerometer and the
gyroscope of a smartphone (Samsung Galaxy S II) worn at the waist by 21
volunteers engaged in six different activities (walking, walking upstairs,
walking downstairs, sitting, standing, laying) [2][]. This analysis is an
example of supervised learning
We show that appropriate classification algorithms are able to correctly
predict the activity of the user in over 90% of the cases.
## Methods
### Data
The data were downloaded from the assignment webpage in the form of an R data
file, loaded and analysed with the R programming language[3][].
They consist of 7352 observations of 563 variables. Of these, 561 represent
various measurement from the accelerometer and the gyroscope, one variable
indicates the subject and one variable labels which of the activities the
user was performing.
```{r echo=FALSE}
library(tree)
library(randomForest)
load('samsungData.rda')
missClass = function(values, prediction){
sum((prediction != values) * 1 / length(values))
}
```
While the data from the original experiment are taken from 30 volunteers, the
data provided for the assignment only contain observations from 21. The sensors
embedded in the smartphone measure linear acceleration and angular velocity in
the 3 axes at a constant rate of 50 Hz. The 561 features reported come from
different pre-processing steps. For example, both time and frequency domain are
reported, for the axial components as well as for the total magnitude, summary
measures as maximum and minimum per time window and so on. All observations
are normalized to lie in the interval [-1, 1].
```{r}
max(samsungData[,-c(562,563)])
min(samsungData[,-c(562,563)])
length(unique(samsungData$subject))
names(samsungData)[1:10]
```
### Data cleaning
Since the variable names contain several punctuation characters that are part
of the syntax in R (like parentheses), we substitute them with underscores.
Moreover, several variable names are repeated. This cannot be explained as an
accidental duplication of a column because the values are different. Rather
than removing these columns then, we renamed all variables to make them unique.
In order to avoid overfitting and obtain a fair estimate of the prediction
error, we split the data in two non-overlapping sets; one for training and one
for testing. In a real-life application this would translate in the fact that
a smartphone would be able to detect the activity of its user without the need
for a user calibration. According to the assignment, the training set contains
only observations from subjects 1, 3, 5 and 6, while the test set only those
from subjects 27, 28, 29 and 30.
```{r}
# reformat names and cure duplicates, activity as factor
names(samsungData) <- gsub('[[:punct:]]', "_", names(samsungData))
dyn_vars <- dim(samsungData)[2]-2
suff <- paste0("_v", 1:dyn_vars)
names(samsungData)[1:dyn_vars] <- paste0(names(samsungData)[1:dyn_vars], suff)
samsungData$activity <- as.factor(samsungData$activity)
# split data in train and test sets
trainData <- subset(samsungData, subject==1 | subject==3 | subject==5 | subject==6)
testData <- subset(samsungData, subject==27 | subject==28 | subject==29 | subject==30)
```
### Predictive models
We tested the performance of two classifiers: decision trees, implemented in
the package "tree"[4][] and random forests, implemented in the package
"randomForest"[5][].
## Results
### Decision tree
```{r}
# decision prediction
samsung_tree <- tree(activity ~ ., data=trainData)
tree_preds <- predict(samsung_tree, testData)
missClass(tree_preds, testData$activity)
```
library(tree)
library(randomForest)
load('samsungData.rda')
missClass = function(values, prediction){
sum((prediction != values) * 1 / length(values))
}
max(samsungData[,-c(562,563)])
min(samsungData[,-c(562,563)])
length(unique(samsungData$subject))
names(samsungData)[1:10]
# reformat names and cure duplicates, activity as factor
names(samsungData) <- gsub('[[:punct:]]', "_", names(samsungData))
dyn_vars <- dim(samsungData)[2]-2
suff <- paste0("_v", 1:dyn_vars)
names(samsungData)[1:dyn_vars] <- paste0(names(samsungData)[1:dyn_vars], suff)
samsungData$activity <- as.factor(samsungData$activity)
# split data in train and test sets
trainData <- subset(samsungData, subject==1 | subject==3 | subject==5 | subject==6)
testData <- subset(samsungData, subject==27 | subject==28 | subject==29 | subject==30)
# decision prediction
samsung_tree <- tree(activity ~ ., data=trainData)
tree_preds <- predict(samsung_tree, testData)
missClass(tree_preds, testData$activity)
summary(samsung_tree)
plot(samsung_tree)
text(samsung_tree)
tree_preds <- predict(samsung_tree, testData)
tree_preds
?tree
library(tree)
library(randomForest)
#library(ggplot2)
load('samsungData.rda')
missClass = function(values, prediction){
sum((prediction != values) * 1 / length(values))
}
# reformat names and cure duplicates, activity as factor
names(samsungData) <- gsub('[[:punct:]]', "_", names(samsungData))
dyn_vars <- dim(samsungData)[2]-2
suff <- paste0("_v", 1:dyn_vars)
names(samsungData)[1:dyn_vars] <- paste0(names(samsungData)[1:dyn_vars], suff)
samsungData$activity <- as.factor(samsungData$activity)
# split data in train, test and validate sets
trainData <- subset(samsungData, subject==1 | subject==3 | subject==5 | subject==6)
testData <- subset(samsungData, subject==27 | subject==28 | subject==29 | subject==30)
# decision tree prediction
samsung_tree <- tree(activity ~ ., data=trainData)
tree_preds <- predict(samsung_tree, testData)
missClass(tree_preds, testData$activity)
tree_preds
library(randomForest)
samsung_tree <- tree(activity ~ ., data=trainData)
tree_preds <- predict(samsung_tree[1, ], testData)
tree_preds <- predict(samsung_tree, testData)
str(tree_preds)
dim(testData)
tree_preds[[2]]
tree_preds[[1]]
tree_preds[1]
tree_preds[2]
tree_preds[6]
dim(tree_preds)
tree_preds
tree_preds[,1]
tree_preds[,2]
tree_preds[,6]
str(tree_preds)
tree_preds[[1]]
tree_preds[[2]]
tree_preds[[2,]]
tree_preds[[1,]]
tree_preds[2]
?str
ls.str(tree_preds)
tree_preds
type(tree_preds)
typeof(tree_preds)
head(tree_preds)
head(tree_preds, 40)
names(tree_preds)
head(tree_preds, 40)
tail(tree_preds)
tree_preds[0,]
activ_labels <- tree_preds[0, ]
which.max(tree_preds[3,])
which.max(tree_preds[3,])[1]
wm <- which.max(tree_preds[3,])
str(wm)
wm[[1]]
wm[[2]]
wm[[1]]
sapply(tree_preds, which.max)
sapply(tree_preds, which.max, 1)
?sapply
library(plyr)
aaply(tree_preds, 1, which.max)
al <- activ_labels[aaply(tree_preds, 1, which.max)]
head(al)
activ_labels <- tree_preds[0, ]
best_act <- aaply(tree_preds, 1, which.max)
head(best_act)
head(best_act, 40)
head(tree_preds)
activ_labels[best_act]
activ_labels[best_act[1:10]]
activ_labels[1]
activ_labels
str(activ_labels)
activ_labels[0,]
activ_labels[0,1]
activ_labels[0,3]
activ_labels[0]
activ_labels[2]
activ_labels[0,]
activ_labels <- c("laying", "sitting", "standing", "walk", "walkdown", "walkup")
best_act <- aaply(tree_preds, 1, which.max)
activ_labels[best_act[1:10]]
predicted_actov <- activ_labels[best_act]
predicted_activ <- activ_labels[best_act]
missClass(predicted_activ, testData$activity)
# decision tree prediction
library(plyr)
samsung_tree <- tree(activity ~ ., data=trainData)
tree_preds <- predict(samsung_tree, testData)
activ_labels <- c("laying", "sitting", "standing", "walk", "walkdown", "walkup")
best_act <- aaply(tree_preds, 1, which.max)
predicted_activ <- activ_labels[best_act]
missClass(predicted_activ, testData$activity)
?tree
predict.tree
library(tree)
predict.tree
tree_preds <- predict(samsung_tree, testData)
tree_preds <- predict(samsung_tree, testData[, -c(562, 563)])
samsung_tree <- tree(activity ~ ., data=trainData[, -562])
tree_preds <- predict(samsung_tree, testData[, -562])
tree_preds
?predict.tree
tree_preds <- predict(samsung_tree, testData[, -562], type="class")
head(tree_preds)
dim(tree_preds)
tree_preds
str(tree_preds)
samsung_tree <- tree(activity ~ ., data=trainData[, -562])
tree_preds <- predict(samsung_tree, testData[, -562], type=class)
tree_preds <- predict(samsung_tree, testData[, -562], type="class)
tree_preds <- predict(samsung_tree, testData[, -562], type="class")
tree_preds <- predict(samsung_tree, testData[, -562], type="class")
#activ_labels <- c("laying", "sitting", "standing", "walk", "walkdown", "walkup")
#best_act <- aaply(tree_preds, 1, which.max)
#predicted_activ <- activ_labels[best_act]
missClass(tree_preds, testData$activity)
# random forest prediction
samsung_rf <- randomForest(activity ~ ., data=trainData[, -562], importance=TRUE,
proximity=TRUE, do.trace=TRUE)
rf_preds <- predict(samsung_rf, testData[, -562])
missClass(rf_preds, testData$activity)
?set.seed
# random forest prediction
set.seed(1234)
samsung_rf <- randomForest(activity ~ ., data=trainData[, -562], importance=TRUE,
proximity=TRUE, do.trace=TRUE)
rf_preds <- predict(samsung_rf, testData[, -562])
missClass(rf_preds, testData$activity)
# random forest prediction
set.seed(123)
samsung_rf <- randomForest(activity ~ ., data=trainData[, -562], importance=TRUE,
proximity=TRUE, do.trace=TRUE)
rf_preds <- predict(samsung_rf, testData[, -562])
missClass(rf_preds, testData$activity)
?randomForest
varImpPlot(samsung_rf)
randomForest::rfcv
?randomForest::rfcv
set.seed(456)
result <- rfcv(trainingData[, -562], trainingData$activity)
with(result, plot(n.var, error.cv, log="x", type="o", lwd=2))
set.seed(456)
result <- rfcv(traingData[, -562], trainData$activity)
with(result, plot(n.var, error.cv, log="x", type="o", lwd=2))
set.seed(456)
result <- rfcv(trainData[, -562], trainData$activity)
set.seed(456)
result <- rfcv(trainData[, -562], trainData$activity)
plot(result$n.var, result$error.cv)
plot(result$n.var, result$error.cv, log="x", type="o", lwd=2)
result$n.var
result$predicted
?tuneRF
rt <- tuneRF(trainData[, 1:561], trainData$activity)
importance(samsung_rf)
head(importance(samsung_rf))
importance(samsung_rf)$MeanDecreaseGini
importance(samsung_rf)
imp <- importance(samsung_rf)
str(imp)
attributes(imp)
imp[[2]]
imp[1]
imp[,8]
sort(imp[,8])
tail(sort(imp[,8]), 10)
names(tail(sort(imp[,8]), 10))
names(tail(sort(imp[,8]), 11))
reduced_features <- c(41, 42, 50, 51, 53, 54, 57, 58, 559, 560)
reduced_trainData <- trainData[, c(reduced_features, 563)]
reduced_trainData <- trainData[, c(reduced_features, 563)]
red_rf <- randomForest(activity ~ ., data=reduced_trainData, importance=TRUE,
proximity=TRUE, do.trace=FALSE))
red_rf <- randomForest(activity ~ ., data=reduced_trainData, importance=TRUE,
proximity=TRUE, do.trace=FALSE)
summary(red_rf)
missClass(predict(red_rf, testData), testData$activity)
imp <- importance(samsung_rf)
names(tail(sort(imp[,7]), 10))
reduced_trainData <- trainData[, names(tail(sort(imp[,7]), 10))]
names_reduced <- names(tail(sort(imp[,7]), 10))
reduced_features <- c(41, 42, 50, 51, 53, 54, 57, 58, 559, 560)
reduced_trainData <- trainData[, c(names_reduced, 563)]
reduced_trainData <- cbind(trainData[, names_reduced], trainData$activity)
red_rf <- randomForest(activity ~ ., data=reduced_trainData, importance=TRUE,
proximity=TRUE, do.trace=FALSE)
reduced_trainData <- cbind(trainData[, names_reduced], trainData$activity)
names(reduced_trainData)
reduced_trainData <- cbind(trainData[, names_reduced], activity=trainData$activity)
names(reduced_trainData)
red_rf <- randomForest(activity ~ ., data=reduced_trainData, importance=TRUE,
proximity=TRUE, do.trace=FALSE)
missClass(predict(red_rf, testData), testData$activity)
sort(imp[,8])
tail(sort(imp[,8]))
imp <- importance(samsung_rf)
names_reduced <- names(tail(sort(imp[,7]), 20))
reduced_trainData <- cbind(trainData[, names_reduced], activity=trainData$activity)
red_rf <- randomForest(activity ~ ., data=reduced_trainData, importance=TRUE,
proximity=TRUE, do.trace=FALSE)
missClass(predict(red_rf, testData), testData$activity)
result$n.var
imp <- importance(samsung_rf)
names_reduced <- names(tail(sort(imp[,7]), 18))
reduced_trainData <- cbind(trainData[, names_reduced], activity=trainData$activity)
red_rf <- randomForest(activity ~ ., data=reduced_trainData, importance=TRUE,
proximity=TRUE, do.trace=FALSE)
missClass(predict(red_rf, testData), testData$activity)
imp <- importance(samsung_rf)
names_reduced <- names(tail(sort(imp[,7]), 30))
reduced_trainData <- cbind(trainData[, names_reduced], activity=trainData$activity)
red_rf <- randomForest(activity ~ ., data=reduced_trainData, importance=TRUE,
proximity=TRUE, do.trace=FALSE)
missClass(predict(red_rf, testData), testData$activity)
plot(result$n.var, result$error.cv, log="x", type="o", lwd=2,
xlab="number of variables",
ylab="error rate")
result$error.cv
MDSplot(samsung_rf, trainData$activity)
mdsplot <- MDSplot(samsung_rf, trainData$activity)
mdsplot$x
mdsplot$ac
str(mdsplot)
str(mdsplot$points)
?MDSplot
mdsplot <- MDSplot(samsung_rf, trainData$activity, pch=as.numeric(trainData$activity), legend=TRUE)
legend()
legend(0.5, 0.2)
legend(0.4,0.2,levels(trainData$activity))
legend(0.0,0.2,levels(trainData$activity))
legend(-0.4,0.2,levels(trainData$activity))
mdsplot <- MDSplot(samsung_rf, trainData$activity)
legend(0.4, 0.2, levels(trainData$activity),
col=brewer.pal(nlevs, 'Set1'), pch=pch)
mdsplot <- MDSplot(samsung_rf, trainData$activity)
legend(0.4, 0.2, levels(trainData$activity),
col=brewer.pal(nlevs, 'Set1'))
imp <- importance(samsung_rf)
names_reduced <- names(tail(sort(imp[,7]), 9))
reduced_trainData <- cbind(trainData[, names_reduced], activity=trainData$activity)
red_rf <- randomForest(activity ~ ., data=reduced_trainData, importance=TRUE,
proximity=TRUE, do.trace=FALSE)
missClass(predict(red_rf, testData), testData$activity)
source('~/.active-rstudio-document', echo=TRUE)
imp <- importance(samsung_rf)
names_reduced <- names(tail(sort(imp[,7]), 20))
reduced_trainData <- cbind(trainData[, names_reduced], activity=trainData$activity)
red_rf <- randomForest(activity ~ ., data=reduced_trainData, importance=TRUE,
proximity=TRUE, do.trace=FALSE)
missClass(predict(red_rf, testData), testData$activity)
imp <- importance(samsung_rf)
names_reduced <- names(tail(sort(imp[,7]), 25))
reduced_trainData <- cbind(trainData[, names_reduced], activity=trainData$activity)
red_rf <- randomForest(activity ~ ., data=reduced_trainData, importance=TRUE,
proximity=TRUE, do.trace=FALSE)
missClass(predict(red_rf, testData), testData$activity)
